<html>
<head>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.js"></script>
</head>
<body>
<h1>The alternative Bitcoin Pie Page</h1>

<table>
<table border="1">
<tr>
<th></th>
<th>Blocks</th>
<th>Coins</th>
<th>BTC</th>
<th>USD</th>
<th>Total USD</th>
<th>Percent</th>
</tr>
<tr id='bitcoin'>
<td>Bitcoin</td>
</tr>
<tr id='namecoin'>
<td>Namecoin</td>
</tr>
</table>

<script type="text" src="http://google.com?callback=some_func"></script>

<script type="text/javascript">

// http://stackoverflow.com/questions/149055/how-can-i-format-numbers-as-money-in-javascript/149099#149099
Number.prototype.formatMoney = function(c, d, t){
var n = this, c = isNaN(c = Math.abs(c)) ? 2 : c, d = d == undefined ? "," : d, t = t == undefined ? "." : t, s = n < 0 ? "-" : "", i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "", j = (j = i.length) > 3 ? j % 3 : 0;
   return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
 };
 
var ColumnIndex = {
	Blocks: 1,
	Coins: 2,
	BTC: 3,
	USD: 4,
	TotalUSD : 5,
	Percent : 6,
	
	Max : 6
}

var Extractors = {
	json : function(path) {
		return function(obj) {
			var parts = path.split('.');
			if (parts.length < 1)
				throw ("Failed to parse path: " + path);
			
			$(parts).each(function() {
				obj = obj[this];
			});
			return obj;
		}
	},
};



<!-- This is where you define the different coins -->
var coinTypes = 
	[{	id: 'bitcoin', 
		price : {url : 'https://mtgox.com/api/0/data/ticker.php', extractor : Extractors.json('contents.ticker.avg')}, 
		blockCount : {url : 'http://blockexplorer.com/q/getblockcount', extractor : Extractors.json('contents')},
		coinsPerBlock : 50,
	}
	];

	
	
// prepare empty table
var header = true;
$('tr').each(function(){
	if (header) {
		header = false;
		return true;
	}
	var row = $(this);
	while (row.find('td').length < ColumnIndex.Max + 1) {
		var td = document.createElement('td');
		//$(td).html("");
		row.append(td);
	}
});

function setCell(rowId, columnIndex, value) {
	var rounded = Math.round(value);
	var decimal = (rounded == value) ? 0 : 2;
	value = value.formatMoney(decimal, '.', ',');
	
	var row = $('#' + rowId);
	var cell = $(row.find('td')[columnIndex]);
	cell.html(value);
}

function getData(url, callback) {
	result = $.getJSON('http://anyorigin.com/get?url=' + url + '&callback=?', callback);
}

function getDataAndFillTable(coin, tickerId, colIndex) {
	var ticker = coin[tickerId];
	getData(ticker.url, function(data) {
		var parsedData = ticker.extractor(data);
		setCell(coin.id, colIndex, parsedData);
		
		if (!coin.fetchedData)
			coin.fetchedData = {};
		coin.fetchedData[tickerId] = parsedData;
		if (Object.keys(coin.fetchedData).length == 2) {
			var coins = coin.coinsPerBlock * coin.fetchedData.blockCount;
			var totalUsd = coins * coin.fetchedData.price;
			
			setCell(coin.id, ColumnIndex.Coins, coins);
			setCell(coin.id, ColumnIndex.TotalUSD, totalUsd);
		}
	});
}

$(coinTypes).each(function() {
	getDataAndFillTable(this, 'price', ColumnIndex.USD);
	getDataAndFillTable(this, 'blockCount', ColumnIndex.Blocks);
	
	if (this.id == 'bitcoin')
		setCell('bitcoin', ColumnIndex.BTC, 1);
});

</script>
</body>
</html>